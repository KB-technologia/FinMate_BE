<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.finmate.assessment.mapper.AssessmentMapper">

    <!-- 1) resultMap -->
    <resultMap id="AssessmentMap" type="org.finmate.assessment.domain.AssessmentVO">
        <!-- 부모 -->
        <id     property="id"       column="a_id"/>
        <result property="question" column="question"/>

        <!-- 자식 목록 -->
        <collection property="choices"
                    ofType="org.finmate.assessment.domain.AssessmentDetailsVO">
            <id     property="id"      column="d_id"/>
            <result property="content" column="content"/>
            <result property="score"   column="score"/>
            <result property="tag"     column="tag"/>
        </collection>
    </resultMap>

    <!-- 2) select -->
    <select id="getList" resultMap="AssessmentMap">
        SELECT
            a.id        AS a_id,
            a.question  AS question,
            d.id        AS d_id,
            d.content   AS content,
            d.score     AS score,
            d.tag       AS tag
        FROM assessment a
                 JOIN assessment_details d
                      ON d.assessment_id = a.id
        ORDER BY a.id, d.id
    </select>

    <!-- 선택지 점수 추출 -->
    <select id="getDetailsById" resultType="org.finmate.assessment.domain.AssessmentDetailsVO">
        SELECT id, content, score, tag
        FROM assessment_details
        WHERE id = #{id}
    </select>

    <!-- userinfo 에 설문 결과 저장 -->
    <insert id="insertUserInfo" parameterType="org.finmate.member.domain.UserInfoVO">
        INSERT INTO user_info (
        user_id,
        animal_id,
        exp,
        profile_summary,
        adventure_score,
        value_tag,
        speed_tag,
        strategy_tag,
        finance_score,
        updated_at
        )
        VALUES (
        #{userId},
        #{animalId},
        #{exp},
        #{profileSummary},
        #{adventureScore},
        #{valueTag},
        #{speedTag},
        #{strategyTag},
        #{financeScore},
        #{updatedAt}
        )
    </insert>
</mapper>
